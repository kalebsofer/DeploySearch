FROM minio/minio:latest

# Install Python and pip using Alpine package manager
USER root
RUN apk add --no-cache \
    python3 \
    py3-pip \
    curl

# Install MinIO Python client
RUN pip3 install minio --no-cache-dir

# Copy initialization files
COPY init.sh /usr/local/bin/init.sh
COPY init_minio.py /usr/local/bin/init_minio.py

# Make script executable
RUN chmod +x /usr/local/bin/init.sh

USER minio
EXPOSE 9000 9001

ENTRYPOINT ["/usr/local/bin/init.sh"]